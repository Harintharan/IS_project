<!--<!DOCTYPE html>-->
<!--<html xmlns:th="http://www.thymeleaf.org">-->
<!--<head>-->
<!--    <title>Secure Chat</title>-->
<!--</head>-->
<!--<body>-->
<!--<h2>Welcome, <span th:text="${currentUser}"></span></h2>-->
<!--<form id="logoutForm" method="post" action="/logout" style="display: inline;">-->
<!--    <input type="submit" value="Logout" />-->
<!--</form>-->


<!--<h3>Online Users:</h3>-->
<!--<ul>-->
<!--    <li th:each="user : ${onlineUsers}" th:if="${user} != ${currentUser}">-->
<!--        <a href="#" th:attr="data-user=${user}" onclick="selectUser(this)"><span th:text="${user}"></span></a>-->
<!--    </li>-->
<!--</ul>-->

<!--<hr>-->

<!--<h3>Chat with: <span id="chattingWith">None</span></h3>-->
<!--<div id="chatBox" style="border: 1px solid black; height: 200px; overflow-y: scroll;"></div>-->

<!--<form id="chatForm">-->
<!--    <input type="text" id="message" placeholder="Enter message" required>-->
<!--    <button type="submit">Send</button>-->
<!--</form>-->

<!--<script th:inline="javascript">-->
<!--    let selectedUser = null;-->
<!--    const username = [[${#strings.escapeJavaScript(currentUser)}]];-->

<!--    function selectUser(el) {-->
<!--        selectedUser = el.getAttribute("data-user");-->
<!--        document.getElementById("chattingWith").innerText = selectedUser;-->
<!--        loadChat();-->
<!--    }-->

<!--    document.getElementById("chatForm").addEventListener("submit", function (e) {-->
<!--        e.preventDefault();-->
<!--        const msg = document.getElementById("message").value;-->

<!--        fetch('/chat/send', {-->
<!--            method: 'POST',-->
<!--            headers: { 'Content-Type': 'application/json' },-->
<!--            body: JSON.stringify({ sender: username, receiver: selectedUser, message: msg })-->
<!--        }).then(() => {-->
<!--            document.getElementById("message").value = "";-->
<!--            loadChat();-->
<!--        });-->
<!--    });-->

<!--    function loadChat() {-->
<!--        if (!selectedUser) return;-->
<!--        fetch(`/chat/history?user1=${username}&user2=${selectedUser}`)-->
<!--            .then(res => res.json())-->
<!--            .then(messages => {-->
<!--                const chatBox = document.getElementById("chatBox");-->
<!--                chatBox.innerHTML = "";-->
<!--                messages.forEach(msg => {-->
<!--                    const p = document.createElement("p");-->
<!--                    p.innerText = msg;-->
<!--                    chatBox.appendChild(p);-->
<!--                });-->
<!--            });-->
<!--    }-->

<!--    setInterval(loadChat, 3000);-->
<!--</script>-->



<!--</body>-->
<!--</html>-->

<!--<body class="container py-4">-->
<!--<div class="d-flex justify-content-between align-items-center mb-3">-->
<!--    <h3>Welcome, <span th:text="${currentUser}"></span></h3>-->
<!--    <form method="post" action="/logout">-->
<!--        <button class="btn btn-danger btn-sm">Logout</button>-->
<!--    </form>-->
<!--</div>-->

<!--<div class="row">-->
<!--    <div class="col-md-4">-->
<!--        <h5>Online Users</h5>-->
<!--        <ul class="list-group user-list">-->
<!--            <li class="list-group-item"-->
<!--                th:each="user : ${onlineUsers}"-->
<!--                th:if="${user} != ${currentUser}">-->
<!--                <a th:attr="data-user=${user}" onclick="selectUser(this)" class="text-decoration-none">-->
<!--                    <span th:text="${user}"></span>-->
<!--                </a>-->
<!--            </li>-->
<!--        </ul>-->
<!--    </div>-->

<!--    <div class="col-md-8">-->
<!--        <h5>Chat with: <span id="chattingWith" class="text-primary">None</span></h5>-->
<!--        <div id="chatBox" class="mb-3"></div>-->

<!--        <form id="chatForm" class="d-flex">-->
<!--            <input type="text" id="message" class="form-control me-2" placeholder="Enter message" required>-->
<!--            <button type="submit" class="btn btn-primary">Send</button>-->
<!--        </form>-->
<!--    </div>-->
<!--</div>-->

<!--<script th:inline="javascript">-->
<!--        let selectedUser = null;-->
<!--        const username = [[${#strings.escapeJavaScript(currentUser)}]];-->

<!--        function selectUser(el) {-->
<!--            selectedUser = el.getAttribute("data-user");-->
<!--            document.getElementById("chattingWith").innerText = selectedUser;-->
<!--            loadChat();-->
<!--        }-->

<!--        document.getElementById("chatForm").addEventListener("submit", function (e) {-->
<!--            e.preventDefault();-->
<!--            const msg = document.getElementById("message").value;-->

<!--            fetch('/chat/send', {-->
<!--                method: 'POST',-->
<!--                headers: { 'Content-Type': 'application/json' },-->
<!--                body: JSON.stringify({ sender: username, receiver: selectedUser, message: msg })-->
<!--            }).then(() => {-->
<!--                document.getElementById("message").value = "";-->
<!--                loadChat();-->
<!--            });-->
<!--        });-->

<!--        function loadChat() {-->
<!--            if (!selectedUser) return;-->
<!--            fetch(`/chat/history?user1=${username}&user2=${selectedUser}`)-->
<!--                .then(res => res.json())-->
<!--                .then(messages => {-->
<!--                    const chatBox = document.getElementById("chatBox");-->
<!--                    chatBox.innerHTML = "";-->
<!--                    messages.forEach(msg => {-->
<!--                        const p = document.createElement("p");-->
<!--                        p.innerText = msg;-->
<!--                        p.classList.add("chat-message");-->
<!--                        chatBox.appendChild(p);-->
<!--                    });-->
<!--                });-->
<!--        }-->

<!--        setInterval(loadChat, 3000);-->
<!--    </script>-->
<!--</body>-->

<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Secure Chat</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <style>
        #chatBox {
            border: 1px solid #ccc;
            height: 300px;
            overflow-y: auto;
            padding: 10px;
            background-color: #f8f9fa;
        }
        #chatBox p {
            margin: 5px 0;
        }
    </style>
</head>
<body class="bg-light">

<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h3>ðŸ‘‹ Welcome, <span th:text="${currentUser}"></span></h3>
        <form id="logoutForm" method="post" action="/logout">
            <input type="submit" value="ðŸšª Logout" class="btn btn-danger btn-sm"/>
        </form>
    </div>

    <div class="row">
        <!-- Online Users -->
        <div class="col-md-4">
            <div class="card">
                <div class="card-header">
                    ðŸŸ¢ Online Users
                </div>
                <ul class="list-group list-group-flush">
                    <li th:each="user : ${onlineUsers}" th:if="${user} != ${currentUser}" class="list-group-item">
                        <a href="#" th:attr="data-user=${user}" onclick="selectUser(this)" class="text-decoration-none">
                            <span th:text="${user}"></span>
                        </a>
                    </li>
                </ul>
            </div>
        </div>

        <!-- Chat Section -->
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    ðŸ’¬ Chat with: <span id="chattingWith" class="fw-bold">None</span>
                </div>
                <div class="card-body">
                    <div id="chatBox"></div>
                </div>
                <div class="card-footer">
                    <form id="chatForm" class="d-flex gap-2">
                        <input type="text" id="message" class="form-control" placeholder="Type a message..." required>
                        <button type="submit" class="btn btn-primary">Send</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- JavaScript for chat functionality -->
<script th:inline="javascript">
    let selectedUser = null;
    const username = [[${#strings.escapeJavaScript(currentUser)}]];

    function selectUser(el) {
        selectedUser = el.getAttribute("data-user");
        document.getElementById("chattingWith").innerText = selectedUser;
        loadChat();
    }

    document.getElementById("chatForm").addEventListener("submit", function (e) {
        e.preventDefault();
        const msg = document.getElementById("message").value;

        fetch('/chat/send', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ sender: username, receiver: selectedUser, message: msg })
        }).then(() => {
            document.getElementById("message").value = "";
            loadChat();
        });
    });

    function loadChat() {
        if (!selectedUser) return;
        fetch(`/chat/history?user1=${username}&user2=${selectedUser}`)
            .then(res => res.json())
            .then(messages => {
                const chatBox = document.getElementById("chatBox");
                chatBox.innerHTML = "";
                messages.forEach(msg => {
                    const p = document.createElement("p");
                    p.innerText = msg;
                    chatBox.appendChild(p);
                });
            });
    }

    setInterval(loadChat, 3000);
</script>

</body>
</html>
